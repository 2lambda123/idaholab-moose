#!/bin/bash
# This script generates gcov code coverage data and rsyncs it to the webserver

app=$1
if [ "$app" == "" ]
then
  app=moose
fi
APP=`echo $app | tr "[:lower:]" "[:upper:]"`

if [ "`hostname -s`" == "helios" -a $GNU_ON == "true" ]
then
  echo "Generating coverage html for $app because this is helios-gnu"
  mkdir coverage
  lcov --base-directory $app --directory $app/src/ --capture --output-file raw.info --ignore-errors gcov,source
  echo "Removing unecessary folders"
  lcov -r raw.info "/usr/include/c++/*" -r raw.info "*/libmesh/*" -r raw.info "*/utils/fparser*" -o $app.info
  echo "Generating html"
  genhtml $app.info -t "$APP Test Coverage" --num-spaces 2 --legend -o coverage
  echo "rsyncing html"
  rsync -av coverage hpcsc:/srv/www/ssl/$APP/
else
  echo "Did NOT generate coverage html because hostname isn't helios-gnu"
fi
