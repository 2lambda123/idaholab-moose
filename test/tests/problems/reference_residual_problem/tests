[Tests]
  issues = '#9151'
  design = 'ReferenceResidualProblem.md'
  [base]
    type = 'Exodiff'
    input = 'reference_residual.i'
    exodiff = 'reference_residual_out.e'
    requirement = 'The system shall have the ability to base convergence on the comparison of '
                  'individual variables to reference quantities of those variables.'
  []
  [scaled_bad]
    type = 'RunApp'
    input = 'reference_residual.i'
    expect_out = 'Solve Did NOT Converge'
    cli_args = 'coef=1e17 Outputs/exodus=false -pc_type svd -pc_svd_monitor -ksp_max_it 10'
    requirement = 'The system shall fail to find a converged solution when basing convergence on '
                  'individual variable reference quantities with poor scaling.'
  []
  [scaled_good]
    type = 'Exodiff'
    input = 'reference_residual.i'
    cli_args = 'coef=1e17 Outputs/file_base=scaled Executioner/automatic_scaling=true '
               'Executioner/verbose=true -pc_type svd -pc_svd_monitor -ksp_max_it 10'
    exodiff = 'scaled.e'
    requirement = 'The system shall have the ability to automatically scale a originally poorly '
                  'scaled problem and achieve convergence based on individual reference quantities'
    petsc_version = '>=3.9.0'
    max_parallel = 2
  []
  [converge_on]
    type = 'RunApp'
    input = 'reference_residual.i'
    expect_out = 'Solve Converged!'
    cli_args = 'Problem/converge_on="u"'
    requirement = 'The system shall have the ability to base system convergence on the convergence '
                  'of a subset of variables.'
  []
  [converge_on_group_error]
    type = 'RunException'
    input = 'reference_residual.i'
    expect_err = 'You added variable \'u\' to a group but excluded it from the convergence check. '
                 'This is not permitted.'
    cli_args = 'Problem/converge_on="v" Problem/group_variables="u v"'
    requirement = 'The system shall require all grouped variables to be included in the convergence '
                  'check.'
  []
  [wildcard]
    type = 'RunApp'
    input = 'reference_residual.i'
    expect_out = 'Solve Converged!'
    cli_args = 'Problem/converge_on="?"'
    requirement = 'The system shall support wildcards for choosing the variables to base convergence '
                  'on.'
  []
  [abs_ref]
    type = 'CSVDiff'
    input = 'abs_ref.i'
    csvdiff = 'abs_ref_out.csv'
    requirement = 'The system shall have the ability to base convergence on the comparison of L2 normalization of the residual for '
                  'individual variables to the sum of the L2 normalization of the absolute value of the residual contributions '
                  'of those variables.'
  []
  [local_normalization]
    type = 'CSVDiff'
    input = 'abs_ref.i'
    csvdiff = 'abs_ref_local_out.csv'
    cli_args = 'Problem/normalization_type=local_L2 Outputs/file_base=abs_ref_local_out'
    requirement = 'The system shall have the ability to base convergence on the comparison of L2 normalization of the residual for '
                  'individual variables locally divided by the absolute value of the residual contributions '
                  'of those variables.'
  []
  [linf_normalization]
    type = 'CSVDiff'
    input = 'abs_ref.i'
    csvdiff = 'abs_ref_Linf_out.csv'
    cli_args = 'Problem/normalization_type=global_Linf Outputs/file_base=abs_ref_Linf_out'
    requirement = 'The system shall have the ability to base convergence on the comparison of Linf normalization of the residual for '
                  'individual variables to the sum of the Linf normalization of the absolute value of the residual contributions '
                  'of those variables.'
  []
  [ad_abs_ref]
    type = 'CSVDiff'
    input = 'ad_abs_ref.i'
    csvdiff = 'ad_abs_ref_out.csv'
    requirement = 'The system shall have the ability to base convergence on the comparison of L2 normalization of the residual for '
                  'individual variables to the sum of the L2 normalization of the absolute value of the residual contributions '
                  'of those variables using AD.'
  []
[]
