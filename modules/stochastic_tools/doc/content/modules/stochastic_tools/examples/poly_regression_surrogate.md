# Polynomial Regression Surrogate

This example is meant to demonstrate how a polynomial regression based surrogate model is trained
and used on a parametric problem. Additionally, the input syntax and results are compared
to those of the Polynomial Chaos (PC) surrogate to highlight possible differences in
applicability. The Polynomial Regression method used here is described in [PolynomialRegressionTrainer.md]
while details of Polynomial Chaos are available under [PolynomialChaos.md].

## Problem Statement

The full-order model in this example is essentially the same as the one described in [surrogate_training.md].
It is a one-dimensional heat conduction model:

!equation
-k\frac{d^2T}{dx^2} = q \,, \quad x\in[0, L]

!equation
\begin{aligned}
\left.\frac{dT}{dx}\right|_{x=0} &= 0 \\
T(x=L) &= T_{\infty}
\end{aligned}

where $T$ is the temperature, $k$ is the thermal conductivity, $L$ is the length of the domain
and $T_\infty$ is the value of the Dirichlet boundary condition.
To make the comparison between different surrogate models easier, only the maximum temperature is
selected to be the Quantity of Interest (QoI):

!equation id=problem
\begin{aligned}\\
T_{\max} &= \max_{x\in[0,L]}T(x)
\end{aligned}

The problem is parametric in a sense that the solution depends on four input parameters:
$T(x,k,q,L,T_\infty)$. To make the differences between the surrogate models more apparent,
two problem setting are considered.
In the first scenario, all of the parameters are assumed to have
[Uniform](Uniform.md) distributions ($\mathcal{U}(a,b)$), while the second considers parameters with
[Normal](Normal.md) distributions ($\mathcal{N}(\mu,\sigma)$).
To be more specific the distributions for the two cases are:

!table id=param_dist
| Parameter | Symbol | Uniform | Normal |
| :- | - | - | - |
| Conductivity | $k$ | $\sim\mathcal{U}(1, 10)$ | $\sim\mathcal{N}(5, 2)$ |
| Volumetric Heat Source | $q$ | $\sim\mathcal{U}(9000, 11000)$ | $\sim\mathcal{N}(10000, 500)$ |
| Domain Size | $L$ | $\sim\mathcal{U}(0.01, 0.05)$ | $\sim\mathcal{N}(0.03, 0.01)$ |
| Right Boundary Temperature | $T_{\infty}$ | $\sim\mathcal{U}(290, 310)$ | $\sim\mathcal{N}(300, 10)$ |

Where the parameters of the uniform distribution are the minimum and maximum bounds,
and the parameters of the normal distribution are the mean and standard deviation.
It must be mentioned that the analytic solution for the maximum temperature is available:

!equation
\begin{aligned}
T_{\max}(k,q,L,T_{\infty}) &= \frac{qL^2}{2k} + T_{\infty}
\end{aligned}

Using this expression and the previously described probability density functions, the mean ($\mu$)
and standard deviation ($\sigma$) of the QoI can be computed for reference:

!table id=ref_results caption=The reference results for the mean and standard deviation of the maximum temperature.
| Moment | Uniform | Normal |
| :- | - | - |
| $\mu_{T_{max}}$ | 301.3219 | 301.2547 |
| $\sigma_{T_{max}}$ | 5.9585 | 10.0011 |


## Solving the problem without uncertain parameters

The first step towards creating a surrogate model is the generation of a full-order model
which can solve [problem] without uncertain parameters. The complete input file
for this case is presented in [sub_app].

!listing surrogates/polynomial_regression/sub.i id=sub_app
         caption=Complete input file for the heat equation problem in this study.

## Training surrogate models

Both surrogate models are constructed using some knowledge about the full-order problem.
This means that the [problem](surrogates/polynomial_regression/sub.i) is solved
multiple times with different parameter samples and the value of the QoI is stored from
every run.
This step is managed by a master input file which creates parameter samples,
transfers them to the sub-application and collects the results from the
completed computations.
For more information about setting up master input files see
[examples/surrogate_training.md] and [examples/parameter_study.md].
The two complete training input files used for the two cases with
the two different parameter distributions
are available under [uniform](surrogates/polynomial_regression/uniform_train.i) and
[normal](surrogates/polynomial_regression/normal_train.i).

The training phase starts with the definition of the distributions listed in [param_dist]
in the `Distributions` block. The uniform distributions can be defined as:

!listing surrogates/polynomial_regression/uniform_train.i block=Distributions

Meanwhile, for the case with normal distributions the block changes to:

!listing surrogates/polynomial_regression/normal_train.i block=Distributions

As a next step, several parameter instances are prepared by sampling the underlying distributions.
The sampling objects can be defined in the `Samplers` block.
The generation of these parameter samples is different for the two surrogate models.
techniques.
Meanwhile the polynomial chaos uses the samples at specific quadrature points
in the parameters space (generated by a [QuadratureSampler.md]),
the polynomial regression model is trained using samples from a [LatinHypercubeSampler.md].
It is visible that the number of sample (`num_rows`) is set in the [LatinHypercubeSampler.md]
to match the number of samples in the tensor-product quadrature set of [QuadratureSampler.md].

!listing surrogates/polynomial_regression/normal_train.i block=Samplers  

The objects in blocks `Controls`, `MultiApps`, `Transfers` and `VectorPostprocessors`
are responsible for managing the communication of the sub-applications, the
execution of the sub-applications and the collection of the results.
For a more detailed description of these blocks see [examples/parameter_study.md]
and [surrogate_training.md].

!listing surrogates/polynomial_regression/normal_train.i block=MultiApps Controls Transfers VectorPostprocessors

The next step in the process is to set up `Trainer` objects to generate the surrogate models
from the available data. This can be done in the `Trainers` block. It is visible that
both examples use the data from a `Sampler` and a `VectorPostprocessor`. A polynomial chaos surrogate of
order 8 and a polynomial regression surrogate with a
polynomial of degree at most 4 is used in this study.
The polynomial chaos trainer also needs knowledge about the underlying parameter distributions
to be able to select matching polynomials.

As a last step in the training process, the important parameters of the trained
surrogates are saved into `.rd` files. These files can be used to construct surrogate models
again without the need to carry out the training process from the beginning.

!listing surrogates/polynomial_regression/normal_train.i block=Outputs

## Evaluation of surrogate models

To evaluate surrogate models, a new master input file has to be created for
[uniform](surrogates/polynomial_regression/uniform_surr.i) and
[normal](surrogates/polynomial_regression/normal_surr.i) parameter distributions.
The input files contain testing distributions for the parameters defined in the `Distributions` block.
In this study, the training distributions are used for the testing of the surrogates as well.
Both surrogate models are tested using the same parameter samples. These samples are selected
using [LatinHypercubeSampler.md] defined in the `Samplers` block.
Since the surrogate models are orders of magnitude faster
than the full-order model, $100,000$ samples are selected for testing (compared to $6,560$ used for training).

!listing surrogates/polynomial_regression/normal_surr.i block=Samplers  

As a next step, two object are created in the `Surrogates` block for the two surrogate modeling techniques.
Both of them are constructed using the information available within the corresponding `.rd` files.

!listing surrogates/polynomial_regression/normal_surr.i block=Surrogates

These surrogate models can be evaluated at the points defined in the testing sample batch.
This is done using objects in the `VectorPostprocessors` block.

!listing surrogates/polynomial_regression/normal_surr.i block=VectorPostprocessors


## Results and Analysis

In this section the results from the different surrogate models are provided. They are compared
to the reference results summarized in [ref_results]. A short analysis of the results is provided
as well to showcase potential issues the user might encounter when using surrogate models.

### Uniform parameter distributions

First, the case with parameters having uniform distributions are investigated.
The statistical moments obtained by the execution of the
[surrogate model](surrogates/polynomial_regression/uniform_surr.i) are summarized in
[stats_uniform].

!table id=stats_uniform caption=Comparison of the statistical moments from different surrogate models.
| Moment | Reference | Poly. Chaos | Poly. Reg. (deg. 4) | Poly. Reg. (deg. 8)|
| :- | - | - | - | - |
| $\mu_{T_{max}}$ | 301.3219 | 301.3218 | 301.3351 | 301.3332 |
| $\sigma_{T_{max}}$ | 5.9585 | 5.9585 | 5.9548 | 5.9537 |

!media poly_reg_uniform_surr_max_hist.svg id=uniform caption=Temperature distributions with uniform parameter distribution

### Normal parameter distributions
