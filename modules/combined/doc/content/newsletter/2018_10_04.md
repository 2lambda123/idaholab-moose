# MOOSE Newsletter (October 2018)

## MOOSEDocs

We are continuing to improve documentation for MOOSE, and our new
website recently went live.  All MOOSE Pull Requests which change or
add tests now require additional language which details the tests'
purpose, the GitHub issue(s) associated with the test, and any relevant
design/documentation for the feature being tested.  This additional
documentation serves two purposes. First, it is useful when trying to
understand what a test does, and second, it is also being used as
software life-cycle documentation.

There is also ongoing work being done to convert "MOOSEDown" into LaTeX, and there will be
more announcements on this task in the coming weeks and months.

## ParsedFunction Improvement

The `ParsedFunction` can now take another function as a parameter - similarly to the way it can take
a scalar value or a postprocessor value. An example syntax follows:

```
[./a_fn]
  type = ParsedFunction
  value = sin(x)
[../]
[./parsed_fn]
  type = ParsedFunction
  value = '4*sqrt(a)'
  vars = 'a'
  vals = 'a_fn'
[../]
```

Obtaining the values from a nested function honors the time and space position of the evaluating
function, i.e. in our example `a_fn` will be evaluated at the same time and space position as
`parsed_fn` function.

## App Object/Action Registration Changes

Previously, a MOOSE-based application's main App class contained several registration methods,
e.g. `registerObjects()`, `associateSyntax()`, `registerExecFlags()`, etc., along with a special `extern "C"`
function paired with each one.  We are moving away from these functions in favor of a more
consolidated, simple approach.  Applications should now perform *all* registration (objects,
syntax, actions, exec flags) and special setup inside a static `registerAll()` member function:

```
static void registerAll(Factory & f, ActionFactory & af, Syntax & s);
```

Applications will no longer be expected to register MOOSE framework objects directly - nor perform
any registration for transitive dependencies.  If your `FooApp` application depends on the
`heat_conduction` module and `BarApp`, then your `registerAll()` function should look something like this:

```
FooApp::registerAll(Factory & f, ActionFactory & af, Syntax & s)
{
  Registry::registerObjectsTo(f, {"FooApp"});
  Registry::registerActionsTo(af, {"FooApp"});

  ModulesApp::registerAll(f, af, s);
  BarApp::registerAll(f, af, s);
}

extern "C" void
FooApp__registerAll(Factory & f, ActionFactory & af, Syntax & s)
{
  FooApp::registerAll(f, af, s);
}
```

All registration-related code in your App's constructor should be removed in favor of a single
call: `registerAll(_factory, _action_factory, _syntax);`.  Each application is only responsible to
call `registerAll()` for its *direct* dependencies.  If `BarApp` depends on the `fluid_properties` module
or `BazApp` - then those registrations should occur automatically from calls within
`BarApp::registerAll()` (no need for you to do that in `FooApp`).

Please add the `registerAll()` function to all of your applications/modules.  If your
application/module has no dependent applications, then you can just remove/delete
the old functions (including the `FooApp__register[Bla]` functions) in favor of the new `registerAll()`.
If your application/module does have downstream dependencies, then you will need to keep the old
functions (please add deprecation warnings via the `mooseDeprecated` macro) until the downstream
dependencies have neen updated.  Deprecation messages/warnings have been added to the old
`registerObjects()`, etc. functions in MOOSE and its modules.

If your application has a test app (e.g. FooTestApp) then this is the new convention:


```
...

FooTestApp::FooTestApp(const InputParameters & parameters) : MooseApp(parameters)
{
  FooTestApp::registerAll(
      _factory, _action_factory, _syntax, getParam<bool>("allow_test_objects"));
}

void
FooTestApp::registerAll(Factory & f, ActionFactory & af, Syntax & s, bool use_test_objs)
{
  FooApp::registerAll(f, af, s);
  if (use_test_objs)
  {
    Registry::registerObjectsTo(f, {"FooTestApp"});
    Registry::registerActionsTo(af, {"FooTestApp"});

    // ... register test action syntax, etc.
  }
}

...
```

## Matrix assembly improvement
There is a coupling matrix used to indicate which variables are coupled to each other.
We used to check all possible variable pairs, and it is fine when the number of variables is
small but the setup time may become a little high when the umber of variables is large.
We fix this issue by caching the coupled variable pairs only which will be checked
when assembling the global matrix.


## Bug fixes

- A bug in NodalNormalBC which prevented derived classes from
  correctly using the computed nodal normals was fixed in
  [commit 4910bfa8](https://github.com/idaholab/moose/commit/4910bfa8a8a8cc033985dfcbf8126a9425f49a28).
